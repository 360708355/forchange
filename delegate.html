<!DOCTYPE html>
<html>
	<head>
		<title>复杂事件代理实现机制</title>
		<meta charset="utf-8">
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<style type="text/css">
			#box {
				background: blue;
			}
		</style>
	</head>
	<body>
		
		<div id="box">
			<div class="classA">
				<div class="classB">
					<ul>
						<li>lilili</li>
						<li>lilili</li>
						<li><span>我是深层的span</span></li>
					</ul>
				</div>
				<span>kodo</span>
			</div>
		</div>
		
		<script type="text/javascript">
			var body = document.querySelector("body");
			var box = document.getElementById("box");
			$("#box").on('touchstart','.classA',function(e) {
				console.log(e);
			})
//			$("body").on('touchmove','#box',function(e) {
//				console.log(e);
//			})
//			$("body").on('touchend','#box',function(e) {
//				console.log(e);
//			})
			delegate(box,'click','.classA',function(e) {
//				console.log(e,this);
			})
//			delegate(box,'touchmove','.classA',function(e) {
//				console.log(e,this);
//			})
//			delegate(box,'touchend','.classA',function(e) {
//				console.log(e,this);
//			})
			
			function delegate(agent,type,selector,fn) {
				//为了复杂的选择器实现
				agent.addEventListener(type,function(e) {
					var target = e.target;
					var ctarget = e.currentTarget;
					console.log(target,ctarget)
					do {
						if(filiter(agent,selector,target,e)) {
							fn.call(target,e);
						};
						target = target.parentNode;
					} while(bubble && target != ctarget)
				},false);
				function filiter(agent,selector,target,e) {
					var nodes = agent.querySelectorAll(selector);
					for (var i = 0; i < nodes.length; i++) {
						if (nodes[i] == target) {
							return true;
						}
					}
				}
			}
		</script>
	</body>
</html>
